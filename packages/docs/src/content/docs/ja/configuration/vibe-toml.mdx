---
title: .vibe.toml
description: チーム共有の設定ファイル
sidebar:
  order: 2
---

import { Badge } from "@astrojs/starlight/components";

`.vibe.toml`ファイルには、通常gitにコミットされてチームで共有される設定が含まれます。

## Copy設定

### ファイル

元リポジトリからWorktreeへ個別のファイルをコピー：

```toml
[copy]
files = [".env", "config.json"]
```

#### Globパターン

`files`配列はglobパターンに対応しており、柔軟なファイル選択が可能です：

```toml
[copy]
files = [
  "*.env",              # ルートディレクトリの全.envファイル
  "**/*.json",          # 全JSONファイル（再帰的）
  "config/*.txt",       # config/内の全.txtファイル
  ".env.production"     # 厳密なパスも引き続き利用可能
]
```

**サポートされるパターン：**

| パターン | 説明                                  |
| -------- | ------------------------------------- |
| `*`      | `/`以外の任意の文字にマッチ           |
| `**`     | `/`を含む任意の文字にマッチ（再帰的） |
| `?`      | 任意の1文字にマッチ                   |
| `[abc]`  | ブラケット内の任意の文字にマッチ      |

:::tip[パフォーマンス]
再帰的パターン（`**/*`）は、大規模リポジトリでは処理に時間がかかる場合があります。可能な限り具体的なパターンを使用してください（例：`**/*.json`より`config/**/*.json`）。
:::

### ディレクトリ <Badge text="v0.4.0+" />

ディレクトリ全体を再帰的にコピー：

```toml
[copy]
dirs = [
  "node_modules",      # 厳密なディレクトリパス
  ".cache",            # 隠しディレクトリ
  "packages/*"         # 複数ディレクトリにマッチするGlobパターン
]
```

:::note

- ディレクトリは完全コピーされます（差分同期ではありません）
- `node_modules`のような大きなディレクトリはコピーに時間がかかる場合があります
- マッチしたファイルをコピーする際、ディレクトリ構造は保持されます
  :::

## コピーパフォーマンスの最適化 <Badge text="v0.4.0+" />

vibeはシステムに応じて最適なコピー戦略を自動選択します：

| 戦略            | 使用条件                                    | プラットフォーム |
| --------------- | ------------------------------------------- | ---------------- |
| Clone (CoW)     | APFSでのディレクトリコピー                  | macOS            |
| Clone (reflink) | Btrfs/XFSでのディレクトリコピー             | Linux            |
| rsync           | cloneが利用できない場合のディレクトリコピー | macOS/Linux      |
| Standard        | ファイルコピー、またはフォールバック        | 全て             |

**仕組み：**

- **ファイルコピー**: 単一ファイルの最高パフォーマンスのため、常にDenoネイティブの`copyFile()`を使用
- **ディレクトリコピー**: 利用可能な最速の方法を自動使用

**メリット：**

- Copy-on-Writeは実際のデータではなくメタデータのみをコピーするため非常に高速
- 設定不要 - 最適な戦略が自動検出されます
- 自動フォールバックによりコピーは常に動作します

## フック設定

フック設定の詳細は[フック](/ja/configuration/hooks/)を参照してください。

## Worktree設定 <Badge text="v0.6.0+" />

外部スクリプトを使用してWorktreeディレクトリパスをカスタマイズできます。

### path_script

Worktreeパスを出力するスクリプトを指定：

```toml
[worktree]
path_script = "~/.config/vibe/worktree-path.sh"
```

スクリプトは以下の環境変数を受け取ります：

| 環境変数                | 説明                                | 例                 |
| ----------------------- | ----------------------------------- | ------------------ |
| `VIBE_REPO_NAME`        | リポジトリ名                        | `my-project`       |
| `VIBE_BRANCH_NAME`      | ブランチ名                          | `feat/new-feature` |
| `VIBE_SANITIZED_BRANCH` | サニタイズ済みブランチ名（`/`→`-`） | `feat-new-feature` |
| `VIBE_REPO_ROOT`        | リポジトリルートパス                | `/path/to/repo`    |

**スクリプト例：**

```bash
#!/bin/bash
# ~/.config/vibe/worktree-path.sh
echo "${HOME}/worktrees/${VIBE_REPO_NAME}-${VIBE_SANITIZED_BRANCH}"
```

:::note
スクリプトは標準出力に**絶対パス**を出力する必要があります。
:::

## 完全な例

```toml
[copy]
files = [
  ".env",
  ".env.local",
  "**/*.secret"
]
dirs = [
  "node_modules",
  ".cache",
  "vendor"
]

[hooks]
pre_start = ["echo 'Worktreeを準備中...'"]
post_start = [
  "pnpm install",
  "pnpm db:migrate",
  "pnpm build"
]
pre_clean = ["git stash"]
post_clean = ["echo 'クリーンアップ完了'"]

[worktree]
path_script = "~/.config/vibe/worktree-path.sh"
```
