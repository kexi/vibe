---
title: vibe clean
description: 現在のWorktreeを削除してメインリポジトリに戻る
sidebar:
  order: 3
---

`clean`コマンドは現在のWorktreeを削除し、メインリポジトリに戻ります。

## 使い方

```bash
vibe clean
```

## オプション

### `--force`, `-f`

未コミットの変更がある場合でも確認プロンプトをスキップします。

```bash
vibe clean --force
```

### `--delete-branch`

Worktree削除後にブランチも削除します。

```bash
vibe clean --delete-branch
```

### `--keep-branch`

Worktree削除後もブランチを保持します。設定ファイルの`delete_branch`設定を上書きします。

```bash
vibe clean --keep-branch
```

### `-V`, `--verbose`

実行されるgitコマンドなど、詳細な出力を表示します。

```bash
vibe clean --verbose
```

### `-q`, `--quiet`

不要な出力を抑制します。

```bash
vibe clean --quiet
```

## 設定

`.vibe.toml`でデフォルトの動作を設定できます：

```toml
[clean]
delete_branch = true  # デフォルトでブランチを削除
```

| オプション      | デフォルト | 説明                           |
| --------------- | ---------- | ------------------------------ |
| `delete_branch` | `false`    | Worktree削除後にブランチを削除 |

### 高速削除（パフォーマンス最適化）

デフォルトで、vibeはworktreeディレクトリを一時的な場所に移動し、バックグラウンドで非同期削除する高速削除戦略を使用します。これにより、大きなリポジトリでも`vibe clean`が瞬時に感じられます。

`~/.config/vibe/settings.json`で設定できます：

```json
{
  "version": 3,
  "clean": {
    "fast_remove": true
  }
}
```

| オプション    | デフォルト | 説明                                                |
| ------------- | ---------- | --------------------------------------------------- |
| `fast_remove` | `true`     | 高速非同期削除を使用（移動 + バックグラウンド削除） |

**仕組み:**

1. worktreeディレクトリは隠し`.vibe-trash-*`ディレクトリに瞬時にリネーム（O(1)操作）
2. 空になったディレクトリに対してgit worktreeメタデータをクリーンアップ
3. 実際のファイル削除はバックグラウンドで非同期実行
4. 以前の`.vibe-trash-*`ディレクトリは自動的にクリーンアップ

**注意:** 高速リネームが何らかの理由で失敗した場合、自動的に従来の削除にフォールバックします。

## 動作

### 安全チェック

Worktreeを削除する前に、`vibe clean`は：

1. 未コミットの変更をチェック
2. 変更がある場合は確認を求める
3. pre_cleanフックを実行
4. Worktreeを削除
5. post_cleanフックを実行
6. メインリポジトリにディレクトリを変更

### 未コミットの変更の警告

```
$ vibe clean
未コミットの変更があります。本当にクリーンアップしますか? (y/N)
```

未コミットの変更がある場合、vibeは：

- 警告を表示
- 確認を求める
- 明示的に確認した場合のみ続行

## フック

`clean`コマンドはクリーンアップタスク用のフックをサポートしています：

```toml
[hooks]
pre_clean = ["git stash"]
post_clean = ["echo 'クリーンアップ完了'"]
```

| フック       | 実行タイミング | 作業ディレクトリ |
| ------------ | -------------- | ---------------- |
| `pre_clean`  | Worktree削除前 | 現在のWorktree   |
| `post_clean` | Worktree削除後 | メインリポジトリ |

### pre_cleanフック例

クリーンアップ前に作業を保存：

```toml
[hooks]
pre_clean = [
  "git stash --include-untracked",
  "echo '変更をstashしました'"
]
```

### post_cleanフック例

共有リソースをクリーンアップ：

```toml
[hooks]
post_clean = [
  "docker-compose down",
  "echo 'クリーンアップ完了'"
]
```

## ワークフロー

```
Worktree (現在)
     │
     ├── pre_cleanフックが実行
     │
     ├── git worktree remove
     │
     ├── post_cleanフックが実行
     │
     └── メインリポジトリにcd
            │
            ▼
メインリポジトリ (新しい現在地)
```

## 関連

- [start](/ja/commands/start/) - Worktreeの作成
- [フック](/ja/configuration/hooks/) - クリーンアップフックの設定
